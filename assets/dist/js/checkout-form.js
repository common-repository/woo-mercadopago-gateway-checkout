(()=>{"use strict";function e(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function n(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}!function(t,a,c){var r=parseFloat(t.amount),i=".wc-mp-gateway-form";function l(){c.post(t.ajax_url,{action:"wc_mp_gateway_checkout_get_cart_price",nonce:t.ajax_nonce},(function(e,n,t){e.success&&(r=parseFloat(e.data))}))}a.setPublishableKey(t.public_key),c("form.checkout.woocommerce-checkout").on("checkout_place_order_wc_mp_gateway",(function(){var e=document.querySelector(i);if(s.createToken(e),!e.querySelector('input[name="CcToken"]'))return alert(t.invalid_card_error_alert),!1}));var s={getBin:function(e){return e.substring(0,7)},createToken:function(e){a.clearSession(),a.createToken(e,(function(n,t){if(200===n||201===n){var a=e.querySelector('input[name="CcToken"]');if(a)a.value=t.id;else{var c=document.createElement("input");c.setAttribute("name","CcToken"),c.setAttribute("type","hidden"),c.setAttribute("value",t.id),e.appendChild(c)}}}))}},u=function(){function c(e){var i=this;!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,c),n(this,"showInstallmentLabel",(function(){var e=i.elems.installments.selectedIndex,n=i.elems.installments.options[e].getAttribute("data-label");n.length&&(i.elems.installmentsRateLabel.innerHTML=n)})),n(this,"createCardToken",(function(){i.ccTokenValues.number=i.elems.ccHiddenNumber.value,i.ccTokenValues.name=i.elems.ccName.value,i.ccTokenValues.month=i.elems.ccHiddenMonth.value,i.ccTokenValues.year=i.elems.ccHiddenYear.value,i.ccTokenValues.cvc=i.elems.ccCvc.value,i.ccTokenValues.document=i.elems.ccDocumentNumber.value,s.createToken(i.elems.form)})),n(this,"checkCardToken",(function(e){var n=i.elems.ccHiddenNumber.value;if(n.length<16)return!1;if(i.elems.ccName.value.length<3)return!1;var t=i.elems.ccHiddenMonth.value;if(!t)return!1;var a=i.elems.ccHiddenYear.value;if(!a)return!1;var c=i.elems.ccCvc.value;if(c.length<3)return!1;var r=i.elems.ccDocumentNumber.value;if(r.length<5)return!1;i.ccTokenValues.number===n&&i.ccTokenValues.month===t&&i.ccTokenValues.year===a&&i.ccTokenValues.cvc===c&&i.ccTokenValues.document===r||i.createCardToken()})),n(this,"syncCcNumber",(function(e){var n=e.currentTarget.value.replace(/\D/g,"");i.elems.ccHiddenNumber.value=n})),n(this,"handleNewccNumber",(function(e){var n=s.getBin(i.elems.ccNumber.value);n.length<7||(n=n.replace(/\D/g,""),a.getPaymentMethod({bin:n},i.setPaymentMethodInfo.bind(i)),a.getInstallments({bin:n,amount:r},i.setInstallmentsInfo.bind(i)))})),n(this,"clearExpirationDate",(function(){i.elems.ccHiddenMonth.value="",i.elems.ccHiddenYear.value=""})),n(this,"setExpirationDates",(function(e){var n=e.match(/[0-9]{2}/g);if(2!==n.length)return!1;i.setMonthExpirationDate(n[0]),i.setYearExpirationDate(n[1])})),n(this,"setPaymentMethodInfo",(function(e,n){200===e&&(i.elems.hiddenPaymentMethodId.value=n[0].id,a.getIdentificationTypes())})),n(this,"setInstallmentsInfo",(function(e,n){if(200===e){var t=null,a=null;for(var c in n){var r=n[c];if("gateway"===r.processing_mode){t=r;break}"aggregator"===r.processing_mode&&(a=r)}t?i.elems.hiddenInstallmentsType.value="gateway":a&&(i.elems.hiddenInstallmentsType.value="aggregator",t=a),i.setInstallments(t.payer_costs)}})),n(this,"setInstallments",(function(e){for(;i.elems.installments.options.length;)i.elems.installments.options.remove(0);e.forEach((function(e){var n=document.createElement("option"),t=i.findCftLabel(e.labels);n.text=e.recommended_message,n.setAttribute("data-label",t),n.setAttribute("value",e.installments),i.elems.installments.appendChild(n)}))})),n(this,"setMonthExpirationDate",(function(e){i.elems.ccHiddenMonth.value=e})),n(this,"setYearExpirationDate",(function(e){i.elems.ccHiddenYear.value=e}));var l=document.querySelector(e);this.elems={form:l,ccName:l.querySelector('input[name="ccName"]'),ccExpiry:l.querySelector('input[name="ccExpiry"]'),ccNumber:l.querySelector('input[name="ccNumber"]'),ccCvc:l.querySelector('input[name="ccCvc"]'),ccDocumentNumber:l.querySelector('input[name="docNumber"]'),hiddenPaymentMethodId:l.querySelector('input[name="hiddenPaymentMethodId"]'),installments:l.querySelector('select[name="installments"]'),installmentsRateLabel:l.querySelector(".installments_rate"),hiddenInstallmentsType:l.querySelector('input[name="hiddenInstallmentsType"]'),ccHiddenNumber:l.querySelector('input[name="hiddenCcNumber"]'),ccHiddenMonth:l.querySelector('input[name="hiddenExpiryMonth"]'),ccHiddenYear:l.querySelector('input[name="hiddenExpiryYear"]')},this.ccTokenValues={number:null,name:null,month:null,year:null,cvc:null,document:null},new Card({form:this.elems.form,container:".wc-mp-gateway-form-card",formSelectors:{numberInput:'input[name="ccNumber"]',expiryInput:'input[name="ccExpiry"]',cvcInput:'input[name="ccCvc"]',nameInput:'input[name="ccName"]'},width:t.card_size}),this.elems.ccNumber.addEventListener("keyup",this.handleNewccNumber.bind(this)),this.elems.ccExpiry.addEventListener("keyup",this.handleExpiryDateChange.bind(this)),this.elems.installments.addEventListener("change",this.showInstallmentLabel.bind(this)),this.elems.ccNumber.addEventListener("keyup",this.syncCcNumber.bind(this)),this.elems.form.addEventListener("keyup",this.checkCardToken.bind(this))}var i,l,u;return i=c,(l=[{key:"handleExpiryDateChange",value:function(e){var n=e.currentTarget;n.classList.contains("jp-card-valid")?this.setExpirationDates(n.value):this.clearExpirationDate()}},{key:"findCftLabel",value:function(e){var n=e.length,t=0,a="";for(t=0;t<n;t++){var c=e[t];if(-1!==c.indexOf("CFT_")){a=c;break}}return a}}])&&e(i.prototype,l),u&&e(i,u),c}();c(document.body).on("updated_checkout",(function(){l(),new u(i)})),t.is_checkout_pay_page||l(),new u(i)}(wc_mp_gateway_settings,Mercadopago,jQuery)})();